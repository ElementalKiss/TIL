# 06 UDP 기반 서버/클라이언트

## 06-1 UDP의 이해

### UDP 소켓의 특성

* UDP는 편지와 매우 유사.
* 편지, 보내는 사람 주소, 우표 끝.
* 편지는 분실될 수 있다. 즉 신뢰할 수 없다.

### 그러면 TCP가 짱인가..?

* 신뢰성은 떨어지지만 ACK, SEQ 같은게 필요 없다.
* 구현이 용이.
* 신뢰성보단 성능이 중요시되는 상황에 UDP를 선택할 수 있다.
* **TCP는 흐름제어. UDP는 그런 것이 존재하지 않는다.(이것이 가장 큰 차이점이며 핵심)**
* 편지에 비유했지만 느린 것은 아님.

### UDP의 내부 동작원리

* Host B -> Host A로 전달되도록 하는 것은 IP의 역할이다.
* 하지만 최종 전달은 UDP의 몫. 호스트로 수신된 패킷을 Port 정보를 참조해 최종 목적지인 UDP 소켓에게 전달하는 것.

### UDP의 효율적 사용

* TCP는 연결설정, 해제 과정, 흐르제어로 인해 속도가 느리다.
* 따라서 송수신하는 데이터의 양이 적으나 잦은 연결이 필요한 경우 UCP가 유리하다.

## 06-2 UDP 기반 서버/클라이언트 구현

### 서버와 클라이언트는 연결되어 있지 않습니다.

* 연결 과정이 필요 없다. listen, accept 함수의 호출이 불필요하다.

### UDP 서버건 클라이언트건 하나의 소켓만 있으면 됩니다.

* 우체통만 있다면 이를 이용해 어디든 편지를 보낼 수 있다.
* 여러 개의 호스트라도 한 개의 소켓만으로 여러 호스트에게 전송할 수 있다.

### UDP 기반의 데이터 입출력 함수.

* 연결 지향이 아니므로 주소정보를 써넣으면서 데이터를 발신해야 한다.

```cpp
ssize_t sendto(int sock, void *buff, size_t nbytes, int flags, struct sockaddr *to, socklen_t addrlen);
// 성공 시 전송된 바이트 수, 실패 시 -1
/*
sock 데이터 전송에 사용될 UDP 소켓의 파일 디스크립터
buff 전송할 데이터 저장하고 있는 버퍼
nbytes 전송할 데이터 크기
flags 옵션
to 목적지 주소정보. sockaddr 구조체.
addrlen 매개변수 to로 전달된 주소 값의 구조체 변수 크기
*/
```

* 수신지에선 발신지가 일정치 않기 때문에 발신 정보를 얻을 수 있도록 함수가 정의.

```cpp
ssize_t recvfrom(int sock, void *buff, size_t nbytes, int flags, struct sockaddr *from, socklen_t *addrlen);
// 성공 시 수신한 바이트 수, 실패 시 -1
/*
from 발신지 정보를 채워 넣을 sockaddr 구조체.
*/
```

### UDP 클라이언트 소켓의 주소정보 할당

* TCP는 connect 함수호출 시 자동으로 할당.
* UDP는 sendto 전에 bind를 호출해 주소정보를 할당할 필요가 있다.
* sendto 함수호출까지 주소정보가 할당되지 않았다면 sendto 함수가 처음 호출되는 시점에 IP와 Port가 자동 할당.
* 보통 주소정보 할당과정을 생략하는 것이 일반적인 구현.

## 06-3 UDP의 데이터 송수신 특성과 UDP에서의 connect 함수호출

* 3번 보내면 3번 받아야된다.

### UDP 데이터그램

* UDP 소켓이 전송하는 패킷을 가리켜 데이터그램이라고 표현.
* 패킷의 일종이나 그 자체(패킷 하나)가 하나의 데이터로 의미를 가지므로 이를 데이터그램이라 표현.

### connected UDP 소켓, unconnected UDP 소켓

* sendto 함수 호출
    + UDP 소켓에 목적지의 IP, PorT 번호 등록
    + 데이터 전송
    + UDP 소켓에 등록된 목적지 정보 삭제
* 목적지 정보가 등록되지 않는 소켓을 unconnected 소켓, 등록 되는 소켓을 connected 소켓.
* 일반적인 UDP 소켓은 unconnected.
* 한 소켓에 여러 데이터를 보낸다면 계속해서 등록과 삭제를 반복해 비효율적이다.

### connected UDP 소켓 생성

* UDP 소켓을 대상으로 connect 함수만 호출해주면 끝.
* connect는 목적지 소켓과 연결 과정을 거치지 **않는다.**

