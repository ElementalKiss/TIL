# 07 소켓의 우아한 연결 종료

## 07 TCP 기반의 Half-close

* TCP에선 연결과정보다 중요한 것이 종료 과정.
* 종료 과정에선 예상치 못한 일이 발생할 수 있음.
* 종료 과정은 명확해야 함.

### 일방적인 연결종료의 문제점

* 리눅스는 close, 윈도우는 closesocket 함수 호출은 완전 종료를 의미.
* 일방적으로 한쪽의 close 호출은 우아하지 않음.
* 단절이 되면 데이터를 송수신 하는 과정에 소멸되는 데이터가 생길 수 있음.
* 그래서 송수신 스트림의 일부만 종료(Half-close)하는 방법이 제공되고 있음.

### 소켓과 스트림(Stream)

* 두 호스트가 연결되어 상호간의 데이터으 ㅣ송수신이 가능한 상태를 '스트림이 형성된 상태'라 함.
* 우아한 종료는 이 중 하나의 스트림만 끊는 것.
* close는 두 스트림을 모두 종료하므로 우아한 종료가 아님.

### 우아한 종료를 위한 shutdown 함수

```cpp
int shutdown(int sock, int howto); // 성공시 0, 실패 시 -1
// sock: 종료할 소켓의 파일 디스크립터 전달
// howto: 종료방법에 대한 정보 전달
```

* 두 번째 매개변수 전달되는 인자에 따라 종료 방법이 결정
    + SHUT_RD 입력 스트림 종료
    + SHUT_WR 출력 스트림 종료
    + SHUT_RDWR 입출력 스트림 종료