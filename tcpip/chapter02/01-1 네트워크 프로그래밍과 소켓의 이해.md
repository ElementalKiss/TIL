# 02 소켓의 타입과 프로토콜의 설정

## 02-1 소켓의 프로토콜과 그에 따른 데이터 전송 특성

### 프로토콜이란?

* 대화에 필요한 통신규약을 의미. 컴퓨터 상호간의 대화에 필요한 통신규약. 쉽게 말하면 어떻게 주고 받을지에 대한 약속.

### 소켓의 생성

```cpp
int socket(int domain, int type, int protocol);

// domain 소켓이 사용할 프로토콜 체계(Protocol Family)
// type 소켓의 데이터 전송방식
// protocol 두 컴퓨터간 통신에 사용되는 프로토콜
```

### 프로토콜 체계(Protocol Family)

* 프로토콜도 부류를 가지고 있는데 이 부류정보를 프로토콜 체계라고 부름.

|이름|프로토콜 체계(Protocol Family)|
|--|--|
|PF_INET|IPv4 인터넷 프로토콜 체계|
|PF_INET6|IPv6 인터넷 프로토콜 체계|
|PF_LOCAL|로컬 통신을 위한 UNIX 프로토콜 체계|
|PF_PACKET|Low Level 소켓을 위한 프로토콜 체계|
|PF_IPX|IPX 노벨 프로토콜 체계|
[sys/socket.h에 선언되어 있는 프로토콜 체계]

### 소켓의 타입(Type)

* 소켓의 데이터 전송방식을 의미

### 연결지향형 소켓(SOCK_STREAM)

* 중간에 데이터가 소멸되지 않고 목적지로 전송.
* 전송 순서대로 데이터가 수신.
* 전송되는 데이터의 경계(Boundary)가 존재하지 않음.
* *"사탕 100개를 여러 번에 걸쳐 보냈다. 그리고 받는 사람은 사탕 100개가 쌓인 다음에 이를 한번에 봉지에 담아갔다."*
* 데이터를 송수신하는 소켓 내부적으로 버퍼(Buffer), 바이트 배열을 가지고 있음.
* read, write의 호출횟수는 영결지향형 소켓의 경우 큰 의미가 없기 때문에 **"데이터의 경계가 존재하지 않는다"** 라고 말하는 것.
* 버퍼가 꽉 차면 데이터 손실이 일어날 것 같지만 송신자와 수신자가 쌍방으로 서로 상태를 파악하며 송수신 하므로 특별한 경우가 아니면 데이터 손실을 일어나지 않음.
* 소켓 대 소켓의 연결은 반드시 1:1이어야 한다.
* **신뢰성 있는 순차적인 바이트 기반의 연결지향 데이터 전송 방식 소켓.**

### 비 연결지향형 소켓(SOCK_DGRAM)

* 전송된 순서에 상관없이 가장 빠른 전송 지향.
* 전송된 데이터는 손실의 우려가 있음.
* 전송되는 데이터의 경계(Boundary)가 존재.
* 전송되는 데이터의 횟수는 두 번인데 세 번에 나눠 받을 수 없다. 이런 특성을 **"전송되는 데이터의 경계가 존재한다."** 라고 말하는 것.
* **신뢰성과 순차적 데이터 전송을 보장하지 않는, 고속의 데이터 전송 목적으로 상요하는 소켓.**

### 프로토콜의 최종선택

* protocol 인자는 "하나의 프로토콜 체계 안에 데이터의 전송방식이 동일한 프로토콜이 둘 이상 존재하는 경우", 즉 전송방식은 같지만 그 안에서도 프로토콜이 나뉘는 상황에 사용.

```cpp
// IPv4 인터넷 프로토콜 체계에서 동작하는 연결지향형 데이터 전송 소켓; TCP 소켓
int tcp_socket = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);

// IPv4 인터넷 프로토콜 체계에서 동작하는 비 연결지향형 데이터 전송 소켓; UDP 소켈
int udp_socket = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP);
```
---

## 02-2 윈도우 기반에서 이해 및 확인하기

```cpp
#include <winsock2.h>

// 실패 시 INVALID_SOCKET 반환.
SOCKET socket(int af, int type, int protocol);

```